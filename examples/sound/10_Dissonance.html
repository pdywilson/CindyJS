
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">

    <title>dissonance3.cdy</title>
    <style type="text/css">
        * {
            margin: 0px;
            padding: 0px;
        }

        #CSConsole {
            background-color: #FAFAFA;
            border-top: 1px solid #333333;
            bottom: 0px;
            height: 200px;
            overflow-y: scroll;
            position: fixed;
            width: 100%;
        }
    </style>
<script type="text/javascript" src="../../build/js/Cindy.js"></script>
<script id="csinit" type="text/x-cindyscript">
PL.x=12;
PR.x=12+7;
base=[C,E,G,K,M,O,Q,S];
top=[B,D,F,H,L,N,P,R];
reg=[T,U,V,W,X,Y,Z,P0];
apply(top,#.y=13);
apply(base,#.y=8);
apply(1..8,
  (reg_#).y=(base_#).y+(1/#+.3)*((top_#).y-(base_#).y);
  );

Y.y=-10;
Z.y=-10;
P0.y=-10;

f1=300;

harm=(1,0,1/2,0,1/3,0,1/4);
harm=(1,1,1,1,1);
A.y=0;
s(f1,f2):=0.24/(0.021*f1+19);;
dis1(f1,f2):=(
ss=s(f1,f2);
exp(-3.5*ss*(f2-f1))-exp(-5.75*ss*(f2-f1))
);

dis(f1,f2):=if(f1<f2,dis1(f1,f2),dis1(f2,f1));



sdis(f1,f2):=(
all=
  apply(1..length(harm),(f1*(#^sp),harm_#))++
  apply(1..length(harm),(f2*(#^sp),harm_#));
all=select(all,#_2>.001);
pairs=pairs(all);


sum(pairs,int,
   (int_1_2*int_2_2)*dis(int_1_1,int_2_1)
);
);

resample():=(

n=1000;
if(moving,n=200);
sample=apply(0..n,
x=#/n*3*12-12;
f2=f1*2^(x/12);
(x,40*sdis(f1,f2))
);
    resampled=true;

);
resample();
    resampled=false;

moving=false;

harmso=(0,0,0,0,0,0,0,0);
spo=0;
;
</script>
<script id="csmousedown" type="text/x-cindyscript">
    moving=true;
    resampled=false;

</script>
<script id="csmouseup" type="text/x-cindyscript">
    moving=false;
    if(resampled,resample());

</script>
<script id="csdraw" type="text/x-cindyscript">
FR.y=13;
FR.x=max(4,min(10,FR.x));

fr=2^((FR.x-7)/3)*200;

sp=(PR.x-PL.x)/7;;
PL.y=7;
PL.size=0;
PL.x=12;
PR.y=7;
apply(1..8,
  (top_(#)).x=PL.x+(#-1)*(PR.x-PL.x)/7;
  (base_(#)).x=PL.x+(#-1)*(PR.x-PL.x)/7;
);
h1=|C,T|;
h2=|E,U|;
h3=|G,V|;
h4=|K,W|;
h5=|M,X|;
h6=|O,Y|;
h7=|Q,Z|;
h8=|S,P0|;
harms=(h1,h2,h3,h4,h5,h6,h7,h8);
harms=harms/|harms|;
if(
(|harmso,harms|>0.0001)
%(sp!=spo)
%(fr!=fro)
,harm=harms;resample());
harmso=harms;
spo=sp;
fro=fr;




A.y=0;
f1=fr;
f2=f1*2^(A.x/12);


connect(sample,color->(.5,1,.5),size->2);
//plot(5*sdis(f1,f1*2^(x/12)),start->-12,stop->24);

draw(A,(A.x,sdis(f1,f2)*40),color->(1,1,1));


drawtext((0,-1),"1",size->20,align->"center",color->(1,1,1));
drawtext((12,-1),"2",size->20,align->"center",color->(1,1,1));
drawtext((24,-1),"4",size->20,align->"center",color->(1,1,1));
drawtext((-12,-1),"1/2",size->20,align->"center",color->(1,1,1));

draw((-12,0),(24,0),color->(1,1,1));
apply(-12..24,draw((#,-.2),(#,.2),color->(1,1,1)));
apply(-1..2,draw((#*12,-.2),(#*12,.2),size->3,color->(1,1,1)));
draw(PL+(1.5,0),PL,arrow->true,color->(1,1,1));
draw(PR-(1.5,0),PR,arrow->true,color->(1,1,1));
drawtext((PL+PR)/2+(0,-.2),size->16,align->"center","spread="+sp,color->(1,1,1));
drawtext(PL+(0,7),size->20,"timbre",color->(1,1,1));
drawtext((4,14),size->20,"prime tone",color->(1,1,1));
drawtext((4,12.2),size->16,round(fr)+"Hz",color->(1,1,1));

;

draw((4,13),(10,13),color->(1,1,1),size->2);
</script>
<script id="cskeydown" type="text/x-cindyscript">

dp=3;
apply(1..8,i,
  if(harm_i>0.01,
    playsin(440,duration->3,damp->3,line->(i-1),partials->[1,1.66,2.88,1.3],harmonics->[0.2,0.2,0.2,0.2],amp->0.3);
  )
);
apply(1..8,i,
  if(harm_i>0.01,
     playsin(550,duration->3,damp->3,line->(i+7),partials->[2,1.1,1.2,1.6],harmonics->[0.2,0.2,0.2,0.2],amp->0.3);
  )
);

;
</script>
    <script type="text/javascript">
var cdy = CindyJS({
  scripts: "cs*",
  defaultAppearance: {
    dimDependent: 0.7,
    fontFamily: "sans-serif",
    lineSize: 1,
    pointSize: 5.0,
    textsize: 12.0
  },
  angleUnit: "Â°",
  geometry: [
        {name: "FR", type: "Free", pos: [7,7], color: [1.0, 1.0, 1.0],narrow:80},

      {name: "PL", type: "Free", pos: [8,7], color: [1.0, 1.0, 1.0],narrow:80},
    {name: "PR", type: "Free", pos: [15,7], color: [1.0, 1.0, 1.0],narrow:80},

    {name: "A", type: "Free", pos: [4.0, 0.0, 0.849123854153823], color: [1.0, 1.0, 1.0],narrow:80},
    {name: "B", type: "Free", pos: [-3.2, -4.0, -0.4], color: [1.0, 0.0, 0.0], visible: false},
    {name: "C", type: "Free", pos: [4.0, 3.5, 0.5], color: [1.0, 0.0, 0.0], visible: false},
    {name: "a", type: "Segment", color: [1,1,1], args: ["B", "C"]},
    {name: "D", type: "Free", pos: [-3.6000000000000005, -4.0, -0.4], color: [1.0, 0.0, 0.0], visible: false},
    {name: "E", type: "Free", pos: [4.0, 3.111111111111111, 0.4444444444444444], color: [1.0, 0.0, 0.0], visible: false},
    {name: "b", type: "Segment", color: [1,1,1], args: ["D", "E"]},
    {name: "F", type: "Free", pos: [4.0, 4.0, 0.4], color: [1.0, 0.0, 0.0], visible: false},
    {name: "G", type: "Free", pos: [4.0, 2.8, 0.4], color: [1.0, 0.0, 0.0], visible: false},
    {name: "c", type: "Segment", color: [1,1,1], args: ["F", "G"]},
    {name: "H", type: "Free", pos: [4.0, 3.6363636363636362, 0.36363636363636365], color: [1.0, 0.0, 0.0], visible: false},
    {name: "K", type: "Free", pos: [4.0, 2.5454545454545454, 0.36363636363636365], color: [1.0, 0.0, 0.0], visible: false},
    {name: "d", type: "Segment", color: [1,1,1], args: ["H", "K"]},
    {name: "L", type: "Free", pos: [4.0, 3.3333333333333326, 0.33333333333333337], color: [1.0, 0.0, 0.0], visible: false},
    {name: "M", type: "Free", pos: [4.0, 2.3333333333333335, 0.33333333333333337], color: [1.0, 0.0, 0.0], visible: false},
    {name: "e", type: "Segment", color: [1,1,1], args: ["L", "M"]},
    {name: "N", type: "Free", pos: [4.0, 3.076923076923077, 0.3076923076923077], color: [1.0, 0.0, 0.0], visible: false},
    {name: "O", type: "Free", pos: [4.0, 2.1538461538461537, 0.3076923076923077], color: [1.0, 0.0, 0.0], visible: false},
    {name: "f", type: "Segment", color: [1,1,1], args: ["N", "O"]},
    {name: "P", type: "Free", pos: [4.0, 2.8571428571428577, 0.2857142857142857], color: [1.0, 0.0, 0.0], visible: false},
    {name: "Q", type: "Free", pos: [4.0, 2.0, 0.2857142857142857], color: [1.0, 0.0, 0.0], visible: false},
    {name: "g", type: "Segment", color: [1,1,1], args: ["P", "Q"]},
    {name: "R", type: "Free", pos: [4.0, 2.6666666666666656, 0.26666666666666666], color: [1.0, 0.0, 0.0], visible: false},
    {name: "S", type: "Free", pos: [4.0, 1.8666666666666667, 0.26666666666666666], color: [1.0, 0.0, 0.0], visible: false},
    {name: "h", type: "Segment", color: [1,1,1], args: ["R", "S"]},
    {name: "T", type: "PointOnSegment", pos: [-3.2, -4.0, -0.4], color: [1,.5,.5], args: ["a"],size:3,narrow:80},
    {name: "U", type: "PointOnSegment", pos: [-3.6000000000000005, -4.0, -0.4], color: [1,.5,.5], args: ["b"],size:3,narrow:80},
    {name: "V", type: "PointOnSegment", pos: [-3.9999999999999996, -4.0, -0.4], color: [1,.5,.5], args: ["c"],size:3,narrow:80},
    {name: "W", type: "PointOnSegment", pos: [4.0, 3.6363636363636354, 0.3636363636363637], color: [1,.5,.5], args: ["d"],size:3,narrow:80},
    {name: "X", type: "PointOnSegment", pos: [4.0, 2.9999999999999987, 0.3333333333333333], color: [1,.5,.5], args: ["e"],size:3,narrow:80},
    {name: "Y", type: "PointOnSegment", pos: [4.0, 2.2381334352944777, 0.3076923076923076], color: [1,.5,.5], args: ["f"],size:3,narrow:80},
    {name: "Z", type: "PointOnSegment", pos: [4.0, 2.0782667613448718, 0.28571428571428575], color: [1,.5,.5], args: ["g"],size:3,narrow:80},
    {name: "P0", type: "PointOnSegment", pos: [4.0, 1.8666666666666665, 0.26666666666666666], color: [1,.5,.5], args: ["h"],size:3, printname: "$P_{0}$",narrow:80}
  ],
  ports: [{
    id: "CSCanvas",
    width: 1106,
    height: 550,
    transform: [{visibleRect: [-13.11039948615057, 16, 25.198984481306574, -2.6151523413589643]}],
    grid: 1.0,
    background: "rgb(30,30,30)"
  }],
  csconsole: false,
  cinderella: {build: 1901, version: [2, 9, 1901]}
});
    </script>
</head>
<body>
    <div id="CSCanvas"></div>
</body>
</html>
